# InputKunByAI

Windows向けの入力支援ツールです。Spy++の「ターゲットをドラッグしてウィンドウを特定する」機能を流用しつつ拡張し、ブラウザなどの他アプリに対して、あらかじめ設定したテキストとTABキー操作を自動送信します。

主な特徴
- ドラッグターゲット: 画面左上のアイコンをドラッグし、ブラウザなどの対象アプリ上でマウスボタンを離すと、その座標のコントロールの親ウィンドウに対して入力を送信
- 入力レイアウト: 終了時刻テキストボックスと10個のパネル（各パネルは1行目に大きいコンボ、2行目に小コンボ×3＋開始時刻テキスト）
- 送信順序の自動制御: 終了時刻 → TAB×18 → パネル1の小コンボ群 → パネル1開始時刻 → TAB×2 → 以降のパネル… という順で自動送信
- コンボデータの外部ファイル化: 4つのテキストファイルでコンボの内容を管理（履歴・備考はドラッグ毎に更新）
- 時刻コンテキストメニュー: 終了時刻・開始時刻テキストを右クリックすると15分刻みの時刻メニューを表示
- 送信方式: Windows API SendInput による UNICODE 経路での文字送信（ブロックされにくく多くのアプリで安定動作）
- ドラッグ中のUI: メイン画面は不可視化し、システムカーソルを十字に変更（終了後に復元）

動作環境
- OS: Windows 10/11
- .NET SDK: .NET 8
- 言語仕様: C# 12
- フレームワーク: Windows Forms

ビルド・実行
1. .NET 8 SDK をインストール
2. 本リポジトリをクローンまたは展開
3. Visual Studio 2022 以降で InputKunByAI.csproj を開く
4. ソリューション構成を Debug/Release から選択し、ビルド
5. 実行（F5またはCtrl+F5）

UI構成
- 画面上部
  - ドラッグ用アイコン（PictureBox）
  - 終了時刻テキスト（初期値 17:30）
  - 見出しラベル: 「作業番号」「作業区分」「備考」「作業時刻(開始)」
- パネル（10個・FlowLayoutPanel内に縦並び）
  - 1行目: 大きいコンボ（履歴、自由入力不可）
  - 2行目: 小コンボ×3（自由入力可）＋開始時刻テキスト（右クリックで時刻メニュー）
  - パネル1の開始時刻初期値: 08:30

コンボボックスとデータファイル
- すべてのパネルに同一のアイテムセットを読み込みます。
- ファイルの場所: 実行ファイルと同じフォルダ
  - HistoryCombo.txt（履歴: パネルの小コンボ3つをTAB区切りで保存／ドラッグ毎に先頭へ、重複除去、最大500行）
  - BikouCombo.txt（備考: 小コンボ3の入力を先頭へ、重複除去、最大500行）
  - OrderNoCombo.txt（作業番号: ユーザー管理）
  - CodeNoCombo.txt（作業区分: ユーザー管理）
- 初回起動時の自動生成
  - HistoryCombo.txt, BikouCombo.txt が無ければ空ファイルを作成（500行上限にトリム）
  - OrderNoCombo.txt が無ければ以下で作成
    - A000001：作業A000001
    - B000002：作業B000002
    - C000003：作業C000003
  - CodeNoCombo.txt が無ければ以下で作成
    - 020：コード020
    - 031：コード031
    - 032：コード032

送信仕様（概要）
- 送信先: ドロップ座標の子ウィンドウを取得し、その親ウィンドウを対象としてフォーカスを与え、左クリックで確定した後に送信を開始
- 文字送信: SendInput（KEYEVENTF_UNICODE）で1文字ずつ送信
- TAB送信: SendInputでTABキー（押下→離上）
- ドラッグ中: メインフォームは非表示、カーソルは十字に変更（終了後に復元）

送信順序（詳細）
- 終了時刻を送信
- TABを18回送信
- パネル1（2行目）
  - 小コンボ1の文字を「: または ： の前まで」送信 → TAB
  - 小コンボ2の文字を「: または ： の前まで」送信 → TAB
  - 小コンボ3の文字を送信
  - TABで開始時刻へ移動
  - 開始時刻を送信 → TAB×2
- パネル2以降
  - 開始時刻を送信 → TAB×2
  - 小コンボ1 → TAB → 小コンボ2 → TAB → 小コンボ3
  - TABで開始時刻へ戻る
  - 開始時刻を送信 → TAB×2
- 終了条件
  - 最初に開始時刻が空のパネルを検出した時点で、それ以降のパネルは処理しない
  - 次のパネルの開始時刻が空の場合は、代わりに終了時刻を送信して処理を終了
  - 10パネル目の後は次パネルが無いので、代わりに終了時刻を送信

使用方法
1. 必要なコンボや開始時刻、終了時刻を画面で設定
2. 終了時刻や開始時刻のテキストボックスを右クリックすると、15分刻みの時刻メニューから選択可能
3. 左上のターゲットアイコンをブラウザ（Edgeなど）へドラッグ
4. 入力対象のコントロール上でマウスボタンを離すと、対象親ウィンドウにフォーカスとクリックを行い、自動入力が開始
5. 入力完了後、履歴（HistoryCombo.txt と BikouCombo.txt）が更新されます（重複除去・先頭追加・最大500行）

注意事項・既知の制限
- 本ツールはWindows APIでキーボード入力を合成します。管理者権限が必要なアプリには管理者での実行が必要な場合があります。
- ブラウザやWebアプリ側のフォーカスや入力制御により、TAB回数や待機時間（Sleep）を環境に応じて微調整が必要な場合があります。
- 入力対象がIMEやカスタムエディタ、コンテンツセキュリティで制御されている場合、入力が取り込まれない可能性があります。
- ドラッグ中はシステムカーソルを十字に変更します。処理終了時に既定へ復元しますが、異常終了時は復元されない可能性があるため、その場合はOSをログオフ/再起動して既定に戻してください。
- 本ツールはWindows専用です。

実装の要点（開発者向け）
- フォーム: Form1
  - ドラッグ処理: pbDrag_MouseDown
  - 時刻メニュー構築: ctxTime_Opening
  - パネル生成: BuildRows（FlowLayoutPanelへ10パネル動的追加）
  - 起動時ファイル作成/トリム: EnsureDataFiles
  - 履歴更新: UpdateHistoryFiles
  - 入力送信（シーケンス）: ExecuteSendSequence
  - 文字送信（UNICODE）: SendText / SendUnicodeChar（SendInput）
- 外部ファイルの上限行: 起動時に500行へトリム
- UI最適化: パネル枠線、縦方向の余白を最小化、作業区分コンボ幅を半分相当に調整

トラブルシューティング
- 入力が入らない
  - 対象アプリにフォーカスが当たっているか確認（ドラッグ後に1クリックを自動送信しています）
  - 管理者権限アプリへ入力する場合、アプリ自体を管理者として起動
  - TAB回数やSleepを調整（ExecuteSendSequence内の値）
- 文字化け
  - 本実装はUNICODE経由で送信します。対象側が特殊なキー処理を行っている場合、ブラウザ拡張/ページスクリプトの影響を確認
- パネルが1つしか表示されない
  - FlowLayoutPanel.ResumeLayout/PerformLayoutを実行済みです。ウィンドウサイズを広げるかスクロールをご確認ください

ライセンス
- 記載が無い場合は社内利用前提、外部配布時は必要に応じてライセンスを明記してください。

免責事項
- 本ツールの使用により発生したいかなる損害についても作者は責任を負いません。利用は自己責任でお願いします。
